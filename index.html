<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Measurement Uncertainty Calculator</title>
    <title>Created by Dr.A.Allwyn</title>
    <style>
        :root {
            --color-primary: #2180a0;
            --color-primary-hover: #1d7390;
            --color-primary-active: #1a6480;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #1a1a1a;
            --color-text-secondary: #666666;
            --color-border: #e0e0e0;
            --color-success: #27ae60;
            --color-warning: #f39c12;
            --color-error: #e74c3c;
            --color-input-bg: #fafafa;
            --color-card-bg: #f9f9f9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-active) 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--color-surface);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            border: 1px solid var(--color-border);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--color-primary);
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 14px;
            color: var(--color-text);
        }

        .form-group .description {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: 5px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="number"],
        input[type="text"] {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 14px;
            background: var(--color-input-bg);
            color: var(--color-text);
            transition: border-color 0.2s;
        }

        input[type="number"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: var(--color-primary);
            background: var(--color-surface);
        }

        .unit {
            font-size: 13px;
            color: var(--color-text-secondary);
            padding: 8px 12px;
            background: var(--color-card-bg);
            border-radius: 4px;
            min-width: 50px;
            text-align: center;
        }

        .readings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
        }

        .readings-table thead {
            background: var(--color-card-bg);
            border-bottom: 2px solid var(--color-border);
        }

        .readings-table th {
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: var(--color-text);
        }

        .readings-table td {
            padding: 8px 10px;
            border-bottom: 1px solid var(--color-border);
            text-align: center;
        }

        .readings-table input[type="number"] {
            width: 100%;
            padding: 6px 8px;
            margin: 0;
        }

        .result-card {
            background: linear-gradient(135deg, var(--color-card-bg) 0%, #f0f8ff 100%);
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            padding: 20px;
            margin-top: 10px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--color-border);
            font-size: 14px;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: var(--color-text);
        }

        .result-value {
            font-family: 'Courier New', monospace;
            color: var(--color-primary);
            font-weight: 700;
            font-size: 15px;
        }

        .result-value.highlighted {
            background: var(--color-primary);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            min-width: 120px;
            text-align: right;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-primary);
            margin-top: 20px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--color-border);
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid var(--color-primary);
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
            font-size: 13px;
            color: #1565c0;
        }

        .uncertainty-components {
            background: var(--color-card-bg);
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .component-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 13px;
            border-bottom: 1px dashed var(--color-border);
        }

        .component-row:last-child {
            border-bottom: none;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            background: var(--color-card-bg);
            color: var(--color-text);
            border: 1px solid var(--color-border);
            flex: 1;
        }

        .btn-secondary:hover {
            background: var(--color-border);
        }

        .equation {
            background: white;
            border-left: 4px solid var(--color-warning);
            padding: 12px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #c0392b;
            border-radius: 4px;
            overflow-x: auto;
        }

        .fullwidth {
            grid-column: 1 / -1;
        }

        .summary-box {
            background: linear-gradient(135deg, var(--color-success) 0%, #27ae60 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .summary-box h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .summary-box .value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .summary-box .label {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .uncertainty-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .uncertainty-summary {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 22px;
            }

            .main-grid {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š Measurement Uncertainty Calculator</h1>
            <p>ISO GUM Compliant Analysis for Ventilator Volume Calibration</p>
        </header>

        <div class="main-grid">
            <!-- Input Parameters -->
            <div class="card">
                <h2>Test Parameters</h2>
                
                <div class="form-group">
                    <label for="parameter">Measurement Parameter</label>
                    <div class="description">Device/measurement being analyzed</div>
                    <input type="text" id="parameter" placeholder="e.g., Ventilator â€“ Volume" value="Ventilator â€“ Volume">
                </div>

                <div class="form-group">
                    <label for="nominalValue">Nominal Value</label>
                    <div class="description">Expected/target measurement value</div>
                    <div class="input-group">
                        <input type="number" id="nominalValue" value="60" step="0.001">
                        <span class="unit">mL</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="numReadings">Number of Readings (n)</label>
                    <div class="description">Sample size for measurements</div>
                    <input type="number" id="numReadings" value="5" min="2" step="1">
                </div>

                <div class="form-group">
                    <label for="coverageFactor">Coverage Factor (k)</label>
                    <div class="description">k=1.96 (95%), k=2 (â‰ˆ95%), k=3 (99.7%)</div>
                    <input type="number" id="coverageFactor" value="2" step="0.01">
                </div>

                <div class="form-group">
                    <label for="confidenceLevel">Confidence Level</label>
                    <div class="description">Desired confidence interval</div>
                    <div class="input-group">
                        <input type="text" id="confidenceLevel" value="95 %" readonly>
                    </div>
                </div>

                <div class="section-title">Accuracy & Resolution</div>

                <div class="form-group">
                    <label for="accuracy">Analyzer Accuracy</label>
                    <div class="description">Â±% uncertainty of the analyzer</div>
                    <div class="input-group">
                        <input type="number" id="accuracy" value="3" step="0.1">
                        <span class="unit">%</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="resolution">Ventilator Resolution</label>
                    <div class="description">Smallest detectable change</div>
                    <div class="input-group">
                        <input type="number" id="resolution" value="1" step="0.01">
                        <span class="unit">mL</span>
                    </div>
                </div>
            </div>

            <!-- Volume Readings -->
            <div class="card">
                <h2>Volume Readings</h2>
                <div class="info-box">
                    Enter the measured volume values from your calibration experiment. These readings will be used to calculate the mean and standard deviation (Type A uncertainty).
                </div>

                <table class="readings-table">
                    <thead>
                        <tr>
                            <th>Reading No</th>
                            <th>Volume (mL)</th>
                        </tr>
                    </thead>
                    <tbody id="readingsBody">
                        <tr>
                            <td>1</td>
                            <td><input type="number" class="reading-input" value="59.857" step="0.001"></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td><input type="number" class="reading-input" value="59.877" step="0.001"></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td><input type="number" class="reading-input" value="59.832" step="0.001"></td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td><input type="number" class="reading-input" value="59.845" step="0.001"></td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td><input type="number" class="reading-input" value="59.869" step="0.001"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Results Section -->
        <div class="card fullwidth">
            <h2>ðŸ“ˆ Analysis Results</h2>

            <div class="uncertainty-summary">
                <div class="result-card">
                    <div class="section-title">Type A Uncertainty (Repeatability)</div>
                    <div class="result-row">
                        <span class="result-label">Mean Value (xÌ„)</span>
                        <span class="result-value" id="meanValue">59.856</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Standard Deviation (s)</span>
                        <span class="result-value" id="stdDeviation">0.0166</span>
                    </div>
                    <div class="equation">Ïƒ = âˆš[Î£(xáµ¢ - xÌ„)Â² / (n-1)]</div>
                    <div class="result-row">
                        <span class="result-label">Standard Uncertainty Type A (u_A)</span>
                        <span class="result-value highlighted" id="typeAUncertainty">0.00743</span>
                    </div>
                    <div class="equation">u_A = s / âˆšn</div>
                </div>

                <div class="result-card">
                    <div class="section-title">Type B Uncertainties</div>
                    
                    <div class="component-row">
                        <span>Accuracy Limit (u_Acc)</span>
                        <span class="result-value" id="accuracyLimit">0.0180</span>
                    </div>
                    <div class="equation">u_Acc = (Nom Ã— Accuracy%) / (100 Ã— âˆš3)</div>

                    <div class="component-row">
                        <span>Half Resolution (u_Res)</span>
                        <span class="result-value" id="halfResolution">0.289</span>
                    </div>
                    <div class="equation">u_Res = (Resolution / 2) / âˆš3</div>

                    <div class="uncertainty-components">
                        <div style="font-weight: 600; margin-bottom: 8px; color: var(--color-primary);">Summary of All Components</div>
                        <div class="component-row">
                            <span>u_A (Repeatability)</span>
                            <span id="componentA">0.00743</span>
                        </div>
                        <div class="component-row">
                            <span>u_Acc (Accuracy)</span>
                            <span id="componentAcc">0.0180</span>
                        </div>
                        <div class="component-row">
                            <span>u_Res (Resolution)</span>
                            <span id="componentRes">0.289</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="result-card">
                <div class="section-title">Combined & Expanded Uncertainty</div>
                <div class="result-row">
                    <span class="result-label">Combined Std. Uncertainty (U_c)</span>
                    <span class="result-value" id="combinedUncertainty">0.289</span>
                </div>
                <div class="equation">U_c = âˆš(u_AÂ² + u_AccÂ² + u_ResÂ²)</div>

                <div class="result-row">
                    <span class="result-label">Expanded Uncertainty (U) - Absolute</span>
                    <span class="result-value highlighted" id="expandedUncertainty">0.578</span>
                </div>
                <div class="equation">U = U_c Ã— k (where k = coverage factor)</div>

                <div class="result-row">
                    <span class="result-label">Expanded Uncertainty - Relative</span>
                    <span class="result-value highlighted" id="expandedUncertaintyPercent">0.96</span>
                </div>
                <div class="equation">U(%) = (U / Nominal Value) Ã— 100</div>
            </div>

            <div class="summary-box">
                <h3>Final Measurement Result</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <div class="value" id="finalResult">59.86 Â± 0.58</div>
                        <div class="label">Expanded Uncertainty @ k = 2 (95% confidence)</div>
                    </div>
                    <div>
                        <div class="value" id="finalPercent">0.96 %</div>
                        <div class="label">Relative Expanded Uncertainty</div>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="calculateUncertainty()">ðŸ”„ Calculate</button>
                <button class="btn-secondary" onclick="resetForm()">â†» Reset</button>
            </div>
        </div>

        <div class="card fullwidth" style="margin-top: 20px; font-size: 12px; color: var(--color-text-secondary);">
            <p><strong>ISO GUM Compliance:</strong> This calculator follows the Guide to the Expression of Uncertainty in Measurement (JCGM 100:2008). Type A uncertainties are evaluated using statistical methods on repeated measurements. Type B uncertainties are estimated from technical specifications using rectangular distributions divided by âˆš3.</p>
            <p style="margin-top: 10px;"><strong>Assumptions:</strong> Normal distribution for expanded uncertainty, rectangular distribution for accuracy and resolution components, independence between uncertainty components.</p>
        </div>
    </div>

    <script>
        // Get all input elements
        function getInputs() {
            return {
                parameter: document.getElementById('parameter').value,
                nominalValue: parseFloat(document.getElementById('nominalValue').value),
                numReadings: parseInt(document.getElementById('numReadings').value),
                coverageFactor: parseFloat(document.getElementById('coverageFactor').value),
                accuracy: parseFloat(document.getElementById('accuracy').value),
                resolution: parseFloat(document.getElementById('resolution').value),
                readings: Array.from(document.querySelectorAll('.reading-input')).map(el => parseFloat(el.value))
            };
        }

        // Calculate mean
        function calculateMean(readings) {
            return readings.reduce((a, b) => a + b, 0) / readings.length;
        }

        // Calculate standard deviation
        function calculateStdDev(readings, mean) {
            const squaredDiffs = readings.map(r => Math.pow(r - mean, 2));
            const variance = squaredDiffs.reduce((a, b) => a + b, 0) / (readings.length - 1);
            return Math.sqrt(variance);
        }

        // Main calculation function
        function calculateUncertainty() {
            const inputs = getInputs();

            // Calculate Type A uncertainty (repeatability)
            const mean = calculateMean(inputs.readings);
            const stdDev = calculateStdDev(inputs.readings, mean);
            const typeAUncertainty = stdDev / Math.sqrt(inputs.numReadings);

            // Calculate Type B uncertainties
            const accuracyLimit = inputs.nominalValue * inputs.accuracy / 100;
            const accuracyUncertainty = accuracyLimit / Math.sqrt(3);

            const halfResolution = inputs.resolution / 2;
            const resolutionUncertainty = halfResolution / Math.sqrt(3);

            // Calculate combined standard uncertainty
            const combinedUncertainty = Math.sqrt(
                Math.pow(typeAUncertainty, 2) +
                Math.pow(accuracyUncertainty, 2) +
                Math.pow(resolutionUncertainty, 2)
            );

            // Calculate expanded uncertainty
            const expandedUncertainty = combinedUncertainty * inputs.coverageFactor;
            const expandedUncertaintyPercent = (expandedUncertainty / inputs.nominalValue) * 100;

            // Update results in DOM
            document.getElementById('meanValue').textContent = mean.toFixed(6);
            document.getElementById('stdDeviation').textContent = stdDev.toFixed(6);
            document.getElementById('typeAUncertainty').textContent = typeAUncertainty.toFixed(6);

            document.getElementById('accuracyLimit').textContent = accuracyLimit.toFixed(4);
            document.getElementById('halfResolution').textContent = halfResolution.toFixed(4);

            document.getElementById('componentA').textContent = typeAUncertainty.toFixed(6);
            document.getElementById('componentAcc').textContent = accuracyUncertainty.toFixed(6);
            document.getElementById('componentRes').textContent = resolutionUncertainty.toFixed(6);

            document.getElementById('combinedUncertainty').textContent = combinedUncertainty.toFixed(6);
            document.getElementById('expandedUncertainty').textContent = expandedUncertainty.toFixed(4);
            document.getElementById('expandedUncertaintyPercent').textContent = expandedUncertaintyPercent.toFixed(3);

            // Final result
            const finalResult = `${mean.toFixed(2)} Â± ${expandedUncertainty.toFixed(2)}`;
            document.getElementById('finalResult').textContent = finalResult;
            document.getElementById('finalPercent').textContent = expandedUncertaintyPercent.toFixed(2) + ' %';
        }

        // Reset form
        function resetForm() {
            location.reload();
        }

        // Calculate on page load
        window.addEventListener('load', () => {
            calculateUncertainty();
        });

        // Real-time calculation on input change
        document.addEventListener('change', calculateUncertainty);
        document.addEventListener('input', calculateUncertainty);
    </script>
</body>
</html>
